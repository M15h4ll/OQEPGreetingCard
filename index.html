<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Name Card Generator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { margin: 0; background-color: #13647a; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scale-up { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
        .animate-scale-up { animation: scale-up 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- ICONS ---
        const IconDownload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        );
        const IconShare = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        );
        const IconRefresh = ({ size = 24, className }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );

        // --- CONFIGURATION ---
        const CARD_CONFIG = {
            width: 1080,
            height: 1350,
            backgroundImagePath: './bg.png',
            text: {
                color: '#FFFFFF', 
                x: 540,
                y: 890,
                fontSizeEn: 30, 
                fontSizeAr: 30,
                fontFamilyEn: 'Montserrat',
                fontFamilyAr: 'Cairo',
                shadowColor: 'rgba(0,0,0,0.3)',
                shadowBlur: 10
            }
        };

        const dataURLtoBlob = (dataurl) => {
            try {
                const arr = dataurl.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while (n--) { u8arr[n] = bstr.charCodeAt(n); }
                return new Blob([u8arr], { type: mime });
            } catch (e) { return null; }
        };

        // --- PARTICLE BACKGROUND ---
        const ParticleBackground = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                let particles = [];

                const resize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.size = Math.random() * 2 + 0.5;
                        this.speedX = Math.random() * 0.5 - 0.25;
                        this.speedY = Math.random() * 0.5 - 0.25;
                        this.opacity = Math.random() * 0.3 + 0.1;
                    }
                    update() {
                        this.x += this.speedX;
                        this.y += this.speedY;
                        if (this.x > canvas.width) this.x = 0;
                        if (this.x < 0) this.x = canvas.width;
                        if (this.y > canvas.height) this.y = 0;
                        if (this.y < 0) this.y = canvas.height;
                    }
                    draw() {
                        ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                const init = () => {
                    particles = [];
                    for (let i = 0; i < 50; i++) particles.push(new Particle());
                };

                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach(p => { p.update(); p.draw(); });
                    animationFrameId = requestAnimationFrame(animate);
                };

                window.addEventListener('resize', resize);
                resize();
                init();
                animate();
                return () => {
                    window.removeEventListener('resize', resize);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);

            return <canvas ref={canvasRef} className="fixed top-0 left-0 w-full h-full pointer-events-none z-0" />;
        };

        // --- MAIN APP ---
        function App() {
            const [step, setStep] = useState(1);
            const [language, setLanguage] = useState('en');
            const [name, setName] = useState('');
            const [generatedImage, setGeneratedImage] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [logoError, setLogoError] = useState(false);
            const [statusMsg, setStatusMsg] = useState('');
            const [bgError, setBgError] = useState(false);

            const handleGenerate = async () => {
                if (!name.trim()) return;
                setIsGenerating(true);
                setStatusMsg('');
                setBgError(false);
                
                setTimeout(() => {
                    generateCanvasImage();
                }, 100);
            };

            const generateCanvasImage = () => {
                const canvas = document.createElement('canvas');
                canvas.width = CARD_CONFIG.width;
                canvas.height = CARD_CONFIG.height;
                const ctx = canvas.getContext('2d');

                const drawContent = () => {
                    const { text } = CARD_CONFIG;
                    
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const isAr = language === 'ar';
                    const fontSize = isAr ? text.fontSizeAr : text.fontSizeEn;
                    const fontFamily = isAr ? text.fontFamilyAr : text.fontFamilyEn;
                    
                    ctx.font = `bold ${fontSize}px "${fontFamily}"`;
                    ctx.fillStyle = text.color;
                    
                    ctx.shadowColor = text.shadowColor;
                    ctx.shadowBlur = text.shadowBlur;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 2;

                    ctx.fillText(name, text.x, text.y);

                    try {
                        const dataUrl = canvas.toDataURL('image/png', 1.0);
                        setGeneratedImage(dataUrl);
                        setStep(3);
                        setIsGenerating(false);
                    } catch (e) {
                        console.error("Security Error:", e);
                        setStatusMsg("Browser Blocked Image Generation");
                        setIsGenerating(false);
                    }
                };

                const bgImage = new Image();
                bgImage.crossOrigin = "Anonymous";
                bgImage.src = CARD_CONFIG.backgroundImagePath;

                bgImage.onload = () => {
                    ctx.drawImage(bgImage, 0, 0, CARD_CONFIG.width, CARD_CONFIG.height);
                    drawContent();
                };

                bgImage.onerror = () => {
                    console.warn("Could not load local bg.png.");
                    setBgError(true);
                    
                    // Fallback Background
                    ctx.fillStyle = '#13647a';
                    ctx.fillRect(0, 0, CARD_CONFIG.width, CARD_CONFIG.height);
                    
                    // Guide Text
                    ctx.font = '30px sans-serif';
                    ctx.fillStyle = 'rgba(255,255,255,0.3)';
                    ctx.textAlign = 'center';
                    ctx.fillText('bg.png not found', CARD_CONFIG.width/2, CARD_CONFIG.height - 50);

                    drawContent();
                };
            };

            const downloadImage = () => {
                if (!generatedImage) return;
                try {
                    const blob = dataURLtoBlob(generatedImage);
                    if (!blob) throw new Error("Image conversion failed");
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `card-${name.replace(/\s+/g, '-')}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    setStatusMsg('Download started!');
                } catch (e) {
                    console.error(e);
                    setStatusMsg('Download error. Try saving manually.');
                }
            };

            const shareImage = async () => {
                if (!generatedImage || !navigator.canShare) {
                    setStatusMsg('Sharing not supported. Please Download.');
                    return;
                }
                try {
                    const blob = dataURLtoBlob(generatedImage);
                    if (!blob) throw new Error("Image conversion failed");
                    const file = new File([blob], `card-${Date.now()}.png`, { type: 'image/png' });
                    const shareData = { files: [file], title: 'My Card', text: name };
                    if (navigator.canShare(shareData)) {
                        await navigator.share(shareData);
                        setStatusMsg('Shared successfully!');
                    } else {
                        setStatusMsg('Browser blocked sharing.');
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') setStatusMsg('Share failed. Try downloading.');
                }
            };

            const isRTL = language === 'ar';
            const ui = {
                enterName: { en: 'Enter Name', ar: 'أدخل الاسم' },
                placeholder: { en: 'Type here...', ar: 'اكتب هنا...' },
                done: { en: 'Generate', ar: 'إرسال' },
                download: { en: 'Download', ar: 'تحميل' },
                share: { en: 'Share', ar: 'مشاركة' },
                again: { en: 'New Card', ar: 'بطاقة جديدة' }
            };

            return (
                <div className="min-h-screen flex items-center justify-center relative overflow-hidden font-sans selection:bg-white selection:text-[#13647a]">
                    <ParticleBackground />

                    <div className="relative z-10 w-full max-w-md p-4 flex flex-col items-center">
                        
                        {/* LOGO SECTION - Only on Step 1 & 2 */}
                        {step !== 3 && (
                            <div className="mb-8 w-full flex justify-center">
                                {/* Container matching Main Logo width (292px) */}
                                <div style={{ width: '292px', maxWidth: '100%' }} className="flex flex-col items-start gap-2">
                                    
                                    {/* OQEP Logo (30% width) - Raised 100px */}
                                    <img 
                                        src="./oqep.png" 
                                        alt="OQEP"
                                        onError={(e) => { e.target.style.display = 'none'; }}
                                        style={{ width: '30%', height: 'auto', objectFit: 'contain', transform: 'translateY(-100px)' }} 
                                    />
                                    
                                    {/* Main Logo */}
                                    <img 
                                        src="./logo.png" 
                                        alt="Logo"
                                        onError={(e) => { e.target.style.display = 'none'; setLogoError(true); }}
                                        style={{ width: '100%', height: 'auto', maxHeight: '127px', objectFit: 'contain' }} 
                                    />
                                </div>
                                {logoError && <div className="text-white/50 border border-white/30 p-4 rounded text-center">logo.png not found</div>}
                            </div>
                        )}

                        {/* STEP 1 */}
                        {step === 1 && (
                            <div className="w-full bg-white/10 backdrop-blur-md border border-white/20 p-8 rounded-3xl shadow-xl animate-fade-in text-center">
                                <h2 className="text-lg text-white mb-6 uppercase tracking-widest font-light">Select Language</h2>
                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={() => { setLanguage('en'); setStep(2); }} className="p-6 rounded-2xl bg-white/10 hover:bg-white hover:text-[#13647a] transition-all border border-white/20 group">
                                        <span className="text-2xl font-bold block mb-2 text-white group-hover:text-[#13647a]">EN</span>
                                        <span className="text-sm text-white/70 group-hover:text-[#13647a]">English</span>
                                    </button>
                                    <button onClick={() => { setLanguage('ar'); setStep(2); }} className="p-6 rounded-2xl bg-white/10 hover:bg-white hover:text-[#13647a] transition-all border border-white/20 group">
                                        <span className="text-2xl font-bold block mb-2 font-['Cairo'] text-white group-hover:text-[#13647a]">عربي</span>
                                        <span className="text-sm text-white/70 group-hover:text-[#13647a]">Arabic</span>
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* STEP 2 */}
                        {step === 2 && (
                            <div className="w-full bg-white/10 backdrop-blur-md border border-white/20 p-8 rounded-3xl shadow-xl animate-fade-in">
                                <button onClick={() => setStep(1)} className="mb-6 text-sm text-white/60 hover:text-white flex items-center gap-1 transition-colors">← Back</button>
                                <h2 className={`text-xl font-bold mb-6 text-white ${isRTL ? 'text-right font-[Cairo]' : ''}`}>{ui.enterName[language]}</h2>
                                <div className="relative mb-8 group">
                                    <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder={ui.placeholder[language]} dir={isRTL ? 'rtl' : 'ltr'}
                                        className={`w-full bg-black/20 border-2 border-white/20 focus:border-white rounded-xl px-4 py-4 text-2xl text-white outline-none transition-all placeholder:text-white/30 ${isRTL ? 'font-[Cairo] text-right' : 'font-[Montserrat] text-left'}`} autoFocus />
                                </div>

                                <button onClick={handleGenerate} disabled={!name.trim() || isGenerating}
                                    className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all transform active:scale-95 ${name.trim() ? 'bg-white text-[#13647a] hover:bg-gray-100' : 'bg-black/20 text-white/30'}`}>
                                    {isGenerating ? <IconRefresh className="animate-spin" /> : ui.done[language]}
                                </button>
                                
                                {statusMsg && <div className="mt-4 text-center text-sm text-white/80 animate-pulse">{statusMsg}</div>}
                            </div>
                        )}

                        {/* STEP 3 */}
                        {step === 3 && generatedImage && (
                            <div className="flex flex-col items-center animate-scale-up w-full">
                                {bgError && <div className="w-full bg-orange-500/80 text-white px-4 py-2 rounded-lg mb-4 text-xs text-center font-bold">bg.png not found</div>}
                                <div className="relative w-3/4 md:w-2/3 rounded-lg overflow-hidden shadow-2xl border border-white/20 mb-6 bg-black mx-auto" style={{ aspectRatio: '1080/1350' }}>
                                    <img src={generatedImage} className="w-full h-full object-contain" alt="Card" />
                                </div>
                                <div className="grid grid-cols-2 gap-3 w-full mb-4">
                                    <button onClick={downloadImage} className="bg-white text-[#13647a] py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors shadow-lg active:scale-95">
                                        <IconDownload /> {ui.download[language]}
                                    </button>
                                    <button onClick={shareImage} className="bg-black/30 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-black/50 transition-colors shadow-lg active:scale-95 border border-white/20">
                                        <IconShare /> {ui.share[language]}
                                    </button>
                                </div>
                                {statusMsg && <div className="mb-4 text-sm text-center text-white font-medium bg-black/20 py-1 px-3 rounded-full animate-pulse">{statusMsg}</div>}
                                <button onClick={() => { setStep(1); setName(''); setStatusMsg(''); }} className="text-white/60 hover:text-white flex items-center gap-2 text-sm mt-2">
                                    <IconRefresh size={14} /> {ui.again[language]}
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>






